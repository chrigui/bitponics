extends ../layout

block head
  base(href="/grow-plans/")
  
  mixin requirejs("/assets/js/pages/grow-plans/index")

  script(type='text/ng-template', id='customize-overview.html')

    div(class="grow-plan-customize", data-bpn-directives-showcase-reveal, data-bpn-directives-smart-overlay)
      header.separator-bottom 
        h2.page-heading
          span(
            class="garden-name", 
            ng-model="sharedDataService.selectedGrowPlan.name", 
            contenteditable,
            spellcheck="false")
          //- | <i class="icon-glyph-new icon-__90_pencil_00e36c" aria-hidden="true" ng-click="sharedDataService.updatefilteredGrowPlans()"></i>

        ul(class="plantlist small-float")
          li(ng-repeat="plant in sharedDataService.selectedGrowPlan.plants | orderBy:name")
            input(id="{{plant._id}}", type='checkbox', name="plants", ng-model="sharedDataService.selected.plants[plant._id]")
            label(for="{{plant._id}}", class="plant btn") 
              {{plant.name}}
              | <i class="icon-glyph-new icon-__73_x_white" aria-hidden="true" ng-click="sharedDataService.updatefilteredGrowPlans()"></i>
          li
            label(class="add btn", ng-click="sharedDataService.activeOverlay = 'PlantOverlay'") 
              | Add
              | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
        
        button.btn.header-action(type="submit", ng-disabled="sharedDataService.submit.updateInProgress || sharedDataService.submit.success")
          | {{sharedDataService.pageMode == 'default' ? 'Save' : 'Activate garden'}}
          img.spinner(src="/assets/img/spinner.svg", ng-show="sharedDataService.submit.updateInProgress")

      div(id="sensors", class="sensors content-module side")
        h2.page-heading-small.date {{sharedDataService.selectedGrowPlan.focusedPhase.name}} 
          br
          | Sensor Ranges
        div(ng-repeat="sensor in sharedDataService.selectedGrowPlan.focusedPhase.sortedSensors", class="sensor data-module {{sensor.code}} {{sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].valueRange ? '' : 'empty'}}", ng-click="triggerSensorOverlay(sensor)")
          h3.main-heading
            | {{sensor.abbrev}}
          div.sensor-data
            
            div.sensor-value {{sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].valueRange | valueRangeDisplay }}
          
          div(class="sensor-type icon {{sensor.code}}", ng-click="sharedDataService.activeOverlay='SensorOverlay'+sensor.abbrev")
            | <i class="icon-glyph icon-glyph-new icon-{{sensor.code}}" aria-hidden="true"></i>
            div.sensor.screen-reader-text {{sensor.code}}

          div
            div(modal="sharedDataService.activeOverlay=='SensorOverlay'+sensor.abbrev", close="close()", options="sharedDataService.modalOptions")
              div(ng-controller="bpn.controllers.SelectionOverlay", class="overlay-contain")
                div(class="close btn", ng-click="close()")
                  | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true" ng-click="close()"></i>
                h3(class="page-heading page-heading-small") {{sensor.name}}
                div(ng-controller="bpn.controllers.growPlan.SensorOverlay", class="sensor-detail-overlay")
                  div(class="overlay-data clearfix")
                    h4 Describe the ideal values for {{sensor.name}} throughout the {{sharedDataService.selectedGrowPlan.focusedPhase.name}} phase. If your sensor readings get out of range,
                      | we'll send you an alert. 
                      //- | You can also specify an accessory to trigger on or off, and even specify the time of day that the ideal range should apply.
                        
                    div(class="hi separator-top")
                      label 
                        span.label If {{sensor.name}} goes above...
                        input(class="no-disable", type="number", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].valueRange.max", size="6")
                        span {{sensor.unit}}
                      label 
                        span.label ...take the following action (optional):
                        textarea(placeholder="Describe what action to take if the value goes above the max.", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].actionAboveMax.description")
                      //- div(ng-show="idealRange.actionAboveMax.control") Turn {{controls[idealRange.actionAboveMax.control].name}} to {{idealRange.actionAboveMax.singleStateValue}}
                      //-     label Trigger the following accessory (optional):
                      //-     div.custom-dropdown-wrap
                      //-       select(class="custom-dropdown", ng-model="idealRange.actionBelowMin.control", ng-options="control._id as control.name for (controlKey,control) in controls")
                      //-         option(value="") None
                      //-       div(class="dblarrow")
                      //-         i

                    div(class="lo separator-top")
                      label 
                        span.label If {{sensor.name}} goes below...
                        input(class="no-disable", type="number", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].valueRange.min", size="6")
                        span {{sensor.unit}}
                      label 
                        span.label ...take the following action (optional):
                        textarea(placeholder="Describe what action to take if the value goes below the min.", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].actionBelowMin.description")
                      //- div(ng-show="idealRange.actionBelowMin.control") Turn {{controls[idealRange.actionBelowMin.control].name}} to {{idealRange.actionBelowMin.singleStateValue}}


                    div.separator-top
                      label What time of day should the ideal range apply?
                      div(class="custom-checkbox-wrap left-orient")
                        input(id="action_control_time_{{$index}}", class="no-disable", type="checkbox", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].noApplicableTimeSpan", ng-click="toggleIdealRangeApplicableTimeSpan(sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code])")
                        label(for="action_control_time_{{$index}}") All Day

                      div.idealRange-applicableTimePicker(ng-hide="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].noApplicableTimeSpan")
                        // TODO: figure out how initialize values when idealRange.applicableTimeSpan is undefined (and leave them alone when it is defined)
                        label.idealRangeStartTime Start Time
                        div.custom-dropdown-wrap
                          select(class="custom-dropdown", ng-required="!sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].noApplicableTimeSpan", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].applicableTimeSpan.startTime", ng-options="time.ms as time.str for time in timesOfDayList")
                            option(value="") Select
                          div(class="dblarrow")
                            i

                        label.idealRangeEndTime End Time
                          div.custom-dropdown-wrap
                            select(class="custom-dropdown", ng-required="!sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].noApplicableTimeSpan", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.idealRangesBySensor[sensor.code].applicableTimeSpan.endTime", ng-options="time.ms as time.str for time in timesOfDayList")
                              option(value="") Select
                            div(class="dblarrow")
                              i


      div(id="phases", class="content-module middle")
        div(ng-controller="bpn.controllers.growPlan.PhasesGraph")
          h2.page-heading-small.date Edit 
            span(contenteditable, ng-model="sharedDataService.selectedGrowPlan.focusedPhase.name")
            |  Phase
          div(data-bpn-directives-navigation-phases-graph)
          p.half-width.centered Use the rings to navigate between phases.

          div.phase-name
            label Phase Name
            input(class="display-ib", type="text", placeholder="Give this phase a name...", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.name")

          
          div.phase-description
            label {{sharedDataService.selectedGrowPlan.focusedPhase.name}} Phase Description
            textarea(placeholder="Write a phase description...", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.description")

          p.phase-duration
            label {{sharedDataService.selectedGrowPlan.focusedPhase.name}} Phase should last
              input(type="number", size="4", placeholder="", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.expectedNumberOfDays", min="0", max="365") 
              | days

          a.btn.remove.no-margin(ng-click="removePhase(sharedDataService.selectedPhaseIndex)") Remove {{sharedDataService.selectedGrowPlan.focusedPhase.name}} Phase


      div(class="content-module side")
        h2.page-heading-small.date {{sharedDataService.selectedGrowPlan.focusedPhase.name}} Schedules
        div(accordion)


          div(ng-show="sharedDataService.userOwnedDevices.length", class="device", id="device", accordion-group, heading="Device")
            ul(class="grid grid--wrapping devicelist")
              li(class="grid-cell") Here is where you can pair up your Bitponics device to your grow plan. Click a device name to select it. After you activate the grow plan, your device will start logging readings and automating any actions defined for your connected accessories.
              li(class="grid-cell", ng-repeat="device in sharedDataService.userOwnedDevices")
                label.btn(ng-class="{on:sharedDataService.selected.deviceId == device._id, off: sharedDataService.selected.deviceId != device._id}")
                  input(type='radio', name="device", value="{{device._id}}", ng-model="sharedDataService.selected.deviceId", ng-change="toggleDevice(device)")
                  | {{device.name}}

          


          div(class="controls", accordion-group, heading="Accessory Timers")
            div(class="grid grid--wrapping", ng-controller="bpn.controllers.growPlan.Actions")
              //- ng-hide="!sharedDataService.selectedGrowPlan.device")
              
              button(
                type="button",
                ng-repeat="control in sharedDataService.selectedGrowPlan.focusedPhase.sortedControls", 
                class="btn-composite control icon-glyph icon-{{control.className}} grid-cell {{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id] ? 'has-action' : ''}}",
                ng-click="triggerActionOverlay(sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id], control)") 
                
                p {{control.name}}
          
                div
                  div(modal="sharedDataService.activeOverlay=='ActionOverlay'+sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id", close="close()", options="sharedDataService.modalOptions")
                    div(ng-controller="bpn.controllers.SelectionOverlay", class="overlay-contain")
                      div(class="close btn", ng-click="close()")
                        | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true" ng-click="close()"></i>
                      h3(class="page-heading page-heading-small") {{control.name}} Timer
                      div(ng-controller="bpn.controllers.growPlan.ActionOverlay", class="action-overlay")
                        div(class="overlay-data clearfix")
                          div
                            label Description
                              textarea(placeholder="Describe the action.", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].description")

                            div
                              div(class="custom-checkbox-wrap")
                                input(
                                  id="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_daily", 
                                  type="checkbox", 
                                  ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].isDailyControlCycle")
                                label(for="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_daily") Daily

                              div(class="", ng-show="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].isDailyControlCycle")
                                label Turn {{control.name}} on at 
                                  div.custom-dropdown-wrap
                                    select(class="custom-dropdown", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].dailyOnTime", ng-options="time.ms as time.str for time in timesOfDayList")
                                      option(value="") Select
                                    div(class="dblarrow")
                                      i

                                label Turn {{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].control.name}} off at 
                                  div.custom-dropdown-wrap
                                    select(class="custom-dropdown", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].dailyOffTime", ng-options="time.ms as time.str for time in timesOfDayList")
                                      option(value="") Select
                                    div(class="dblarrow")
                                      i

                              div(class="", ng-show="!sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].isDailyControlCycle")
                                p {{control.name}} should cycle on/off throughout the phase on the following schedule:
                                
                                div.separator-top
                                  p First, turn {{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].control.name}}
                                  div(class="custom-checkbox-wrap")
                                    input(
                                      id="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_first_on",
                                      type="radio", 
                                      value="1", 
                                      ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[0].controlValue")
                                    label(for="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_first_on") On

                                  div(class="custom-checkbox-wrap")
                                    input(
                                      id="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_first_off",
                                      type="radio", 
                                      value="0", 
                                      ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[0].controlValue")
                                    label(for="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_first_off") Off

                                  div.action-duration
                                    label for
                                      input(type="number", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[0].duration", value="1")
                                    div.custom-dropdown-wrap
                                      select(class="custom-dropdown", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[0].durationType", ng-options="durationType for durationType in actionDurationTypeOptions", value="{{actionDurationTypeOptions[1]}}")
                                        option(value="") Select
                                      div(class="dblarrow")
                                        i
                                  
                                div.separator-top 
                                  p Then turn {{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].control.name}}
                                  div(class="custom-checkbox-wrap")
                                    input(
                                      id="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_then_on", 
                                      type="radio", 
                                      value="1", 
                                      ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[1].controlValue")
                                    label(for="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_then_on") On

                                  div(class="custom-checkbox-wrap")
                                    input(
                                      id="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_then_off",
                                      type="radio", 
                                      value="0", 
                                      ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[1].controlValue")
                                    label(for="action_{{sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id]._id}}_then_off") Off

                                  div.action-duration
                                    label for 
                                      input(type="number", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[1].duration", value="1")
                                    div.custom-dropdown-wrap
                                      select(class="custom-dropdown", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id].cycle.states[1].durationType", ng-options="durationType for durationType in actionDurationTypeOptions", value="{{actionDurationTypeOptions[1]}}")
                                        option(value="") Select
                                      div(class="dblarrow")
                                        i
                            div.separator-top
                              a.btn.remove(ng-click="removeAction(sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsByControl[control._id])") Remove this timer









          div(class="reminders", accordion-group, heading="Reminders")
            div(ng-controller="bpn.controllers.growPlan.Actions", class="content-centered")
              button(
                type="button",
                ng-repeat="action in sharedDataService.selectedGrowPlan.focusedPhase.actionViewModelsNoControl", 
                class="btn-composite action", 
                ng-click="triggerActionOverlay(action)") 
                
                
                div(data-bpn-directives-control-action-graph, data-control-action="action", custom-click="sharedDataService.activeOverlay = 'ActionOverlay' + action._id")
                p {{action.description}}
              
                div
                  div(modal="sharedDataService.activeOverlay=='ActionOverlay'+action._id", close="close()", options="sharedDataService.modalOptions")
                    div(ng-controller="bpn.controllers.SelectionOverlay", class="overlay-contain")
                      div(class="close btn", ng-click="close()")
                        | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true" ng-click="close()"></i>
                      h3(class="page-heading page-heading-small") Action Reminder
                      div(ng-controller="bpn.controllers.growPlan.ActionOverlay", class="action-overlay")
                        div(class="overlay-data clearfix")
                          div
                            label Description
                            textarea(placeholder="Describe the action.", ng-model="action.description")

                          div.separator-top
                            label When should the reminder be sent?
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-model="action.scheduleType")
                                option(value="") Select
                                option(value="phaseStart") Once at the start of the phase
                                option(value="phaseEnd") Once at the end of the phase
                                option(value="repeat") Repeat throughout the phase
                              div(class="dblarrow")
                                i

                          div(ng-show="action.scheduleType != 'repeat'")

                          div(ng-show="action.scheduleType == 'repeat'")
                            div.separator-top 
                              label Every:
                              input(type="number", ng-model="action.overallDuration", value="1")
                              div.custom-dropdown-wrap
                                select(class="custom-dropdown", ng-model="action.overallDurationType", ng-options="durationType for durationType in actionWithNoAccessoryDurationTypeOptions", value="{{actionDurationTypeOptions[0]}}")
                                  option(value="") Select
                                div(class="dblarrow")
                                  i

                            div(ng-show="action.overallDurationType == 'days'")
                              label At 
                              div.custom-dropdown-wrap
                                select(class="custom-dropdown", ng-model="action.offsetTimeOfDay", ng-options="time.ms as time.str for time in timesOfDayList")
                                  option(value="") Select
                                div(class="dblarrow")
                                  i

                            label.separator-top Send me the following message:
                              textarea(ng-model="action.message", placeholder="It's time to...")
                          div.separator-top
                            a.btn.remove(ng-click="removeAction(action)") Remove this reminder

              div.btn(ng-click="triggerActionOverlay()") Add Reminder












        //- h2.page-heading-small.date {{sharedDataService.selectedGrowPlan.focusedPhase.name}} Supplies
        //- div(accordion)
        //-   div(class="grow-systems", id="grow-systems", accordion-group, heading="Grow System")
        //-     ul(class="grid grid--wrapping growsystemlist")
        //-       li(class="grid-cell", ng-repeat="growSystem in sharedDataService.growSystems")
        //-         input(
        //-             id="{{growSystem._id}}",
        //-             type="radio", 
        //-             value="{{growSystem._id}}",
        //-             ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem")
        //-         label(for="{{growSystem._id}}", class="btn")
        //-           | {{growSystem.name}}

        //-   div(class="lights", id="lights", accordion-group, heading="Lights")
        //-     ul(class="grid grid--wrapping lightlist")
        //-       li(class="grid-cell", ng-repeat="light in sharedDataService.lights")
        //-         input(
        //-             id="{{light._id}}",
        //-             type="radio", 
        //-             value="{{light._id}}",
        //-             ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light")
        //-         label(for="{{light._id}}", class="btn")
        //-           | {{light._id}}

        //-   div(class="nutrients", id="nutrients", accordion-group, heading="Nutrients")
        //-     ul(class="grid grid--wrapping nutrientlist")
        //-       li(class="grid-cell", ng-repeat="nutrient in sharedDataService.nutrients")
        //-         input(
        //-             id="{{nutrient._id}}",
        //-             type="radio", 
        //-             value="{{nutrient._id}}",
        //-             ng-model="sharedDataService.selectedGrowPlan.focusedPhase.nutrient")
        //-         label(for="{{nutrient._id}}", class="btn")
        //-           | {{nutrient.name}} by {{nutrient.brand}}






  script(type='text/ng-template', id="template/accordion/accordion.html")

    div(class="accordion", ng-transclude)

  script(type='text/ng-template', id="template/accordion/accordion-group.html")
  
    div(class="accordion-group")
      div(class="accordion-heading")
        a(class="accordion-toggle", ng-click="isOpen = !isOpen", accordion-transclude="heading")
          {{heading}}
      div(class="accordion-body", collapse="!isOpen")
        div(class="accordion-inner", ng-transclude)

  
  script(type='text/ng-template', id='customize-details.html')
      h4.page-heading {{sharedDataService.selectedGrowPlan.name}}

      div.Phases
        div
          section.separator-top
            h5.question-title Total grow plan duration  
            //- input(type="number", name="phase_slider_duration", id="phase_slider_duration", class="no-disable", value="182", ng-model="expectedGrowPlanDuration", ng-change="updatePhaseDurations()") 
            h4(class="page-heading-large seamless-input-wrap")
              input(type="number", 
                    readonly,
                    name="expectedGrowPlanDuration", 
                    id="expectedGrowPlanDuration", 
                    class="seamless-input no-disable", 
                    value="expectedGrowPlanDuration",
                    ng-model="expectedGrowPlanDuration")
              span Days
              
            //- h5(class="starting-day question-title seamless-input-wrap page-heading-small") I am starting on day
            //-   input(class="seamless-input-with-bg date-duration text-align-c no-disable", 
            //-         type="number", 
            //-         ng-model="sharedDataService.growPlanInstance.currentGrowPlanDay", 
            //-         min="0",
            //-         max="{{expectedGrowPlanDuration}}")
          
          //- div.phase-sliders
          section.separator-top
            h5.question-title Phases
            ul(class="phase-tabs")
              li(ng-repeat="phase in sharedDataService.selectedGrowPlan.phases", 
                  class="btn inverse-btn", 
                  ng-class="{selected: sharedDataService.selectedGrowPlan.focusedPhase == phase}", 
                  ng-click="setCurrentVisiblePhase(phase, $index)") {{ phase.name || 'New Phase' }}
                div(class="remove icon", ng-click="removePhase($index)")
                  | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true" ng-hide="sharedDataService.selectedGrowPlan.focusedPhase == phase"></i>
                  | <i class="icon-glyph-new icon-__73_x_white" aria-hidden="true" ng-show="sharedDataService.selectedGrowPlan.focusedPhase == phase"></i>
              li(class="btn inverse-btn", ng-click="addPhase()") Add New Phase
                div(class="add icon")
                  | <i class="icon-glyph-new icon-__64_plus_00e36c" aria-hidden="true"></i>

            div(class="phase-slider")
              h4(class="page-heading-large seamless-input-wrap")
                span {{ sharedDataService.selectedGrowPlan.focusedPhase.name || 'New Phase' }} lasts for
                input(class="seamless-input-with-bg date-duration text-align-c no-disable", 
                      name="expectedNumberOfDays", 
                      value="1", 
                      type="number", 
                      ng-model="sharedDataService.selectedGrowPlan.focusedPhase.expectedNumberOfDays", 
                      ng-change="setExpectedGrowPlanDuration()",
                      min="1")
                span days
              //- div(class="phase-slider-slider")
              //-   input(type="range", name="phase_slider_{{$index}}", id="phase_slider_{{$index}}", class="phase-slider-input", value="0", min="0", max="{{expectedGrowPlanDuration}}", ng-model="phase.expectedNumberOfDays")

              section
                div.phaseName
                  label Phase Name
                  input(type="text", placeholder="Give this phase a name...", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.name")

                div.phaseDescription
                  label Phase Description
                  textarea(placeholder="Write a phase description...", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.description")

                div(class="phaseEndDescription")
                    label Phase End Description
                    textarea(placeholder="This phase is over when...", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.phaseEndDescription")

                ul(class="phase-tabs separator-top")
                  li(ng-repeat="phaseSection in growPlanPhaseSectionUITabs",
                      class="btn inverse-btn {{ phaseSection | lowercase }}", 
                      ng-class="{selected: selected.selectedGrowPlanPhaseSection == $index}", 
                      ng-click="setCurrentPhaseSectionTab($index)",
                      ng-show="phaseSection != 'Device'") {{ phaseSection }}

                div(class="growSystem", ng-show="selected.selectedGrowPlanPhaseSection == 0")
                  div.question
                    h4(class="page-heading-large separator-top") System
                    a(href, class="edit-btn", ng-click="sharedDataService.activeOverlay = 'GrowSystemOverlay'")
                      | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                      | Choose a different grow system
                    label Name
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.name", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.name")
                    label Description
                    textarea(ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.description", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.description")
                    label Type
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.type")
                    label Reservoir Size (gallons)
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.reservoirSize", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.reservoirSize")
                    label Plant Capacity
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.plantCapacity", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.plantCapacity")
                    h7 Size (feet)
                    input(type="text", placeholder="W", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.w", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.w")
                    input(type="text", placeholder="H", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.h", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.h")
                    input(type="text", placeholder="D", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.d", value="sharedDataService.selectedGrowPlan.focusedPhase.growSystem.overallSize.d")

                  div(class="growMedium question")
                    h4(class="page-heading-large separator-top") Grow Medium
                    input(type='text', ng-model="sharedDataService.selectedGrowPlan.focusedPhase.growMedium")

                  div(class="nutrients question")
                    h4(class="page-heading-large separator-top") Nutrients
                    a(href, class="edit-btn", ng-click="sharedDataService.activeOverlay = 'NutrientOverlay'")
                      | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                      | Add a nutrient
                    ul.grid
                      li(ng-repeat="nutrient in sharedDataService.selectedGrowPlan.focusedPhase.nutrientsViewModel")
                        input(id="gpedit_{{sharedDataService.selectedGrowPlan.focusedPhase._id}}_nutrients", type='checkbox', name="gpedit_{{sharedDataService.selectedGrowPlan.focusedPhase._id}}_nutrients", value="{{nutrient._id}}", checked=true)
                        label(for="gpedit_{{sharedDataService.selectedGrowPlan.focusedPhase._id}}_nutrients") {{nutrient.name}} - {{nutrient.brand}}
                
                div(class="light", ng-show="selected.selectedGrowPlanPhaseSection == 1")
                  //- h6 Light
                  div.question
                    h4(class="page-heading-large separator-top") Fixture
                    a(href, class="edit-btn", ng-click="sharedDataService.activeOverlay = 'FixtureOverlay'")
                      | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                      | Choose a different fixture
                    label Brand
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.brand", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.brand")
                    label Name
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.name", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.name")
                    label Type
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.type", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.type")
                    label Watts
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.watts", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.watts")
                    label # of bulbs per fixture
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.bulbCapacity", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture.bulbCapacity")
                    label # of fixtures
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.fixtureQuantity", value="sharedDataService.selectedGrowPlan.focusedPhase.light.fixtureQuantity")
                  div.question
                    h4(class="page-heading-large separator-top") Bulbs
                    a(href, class="edit-btn", ng-click="sharedDataService.activeOverlay = 'BulbOverlay'") 
                      | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                      | Choose a different bulb
                    label Brand
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.brand", value="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.brand")
                    label Name
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.name", value="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.name")
                    label Type
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.type", value="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.type")
                    label Watts
                    input(type="text", ng-model="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.watts", value="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb.watts")

                div(class="idealRanges", ng-show="selected.selectedGrowPlanPhaseSection == 2")
                  h4(class="page-heading-large separator-top") Ideal Sensor Ranges
                  p Here's where you describe the ideal values for your sensors throughout this phase. If your sensor readings get out of range,
                    | we'll send you an alert. You can also specify an accessory to trigger on or off, and even specify the time of day 
                    | that the ideal range should apply.
                  ul
                    li
                      label(class="add btn", ng-click="addIdealRange(sharedDataService.selectedGrowPlan.focusedPhase);") 
                        | Add
                        | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>

                    li(class="question", ng-repeat="idealRange in sharedDataService.selectedGrowPlan.focusedPhase.idealRanges")
                      div(class="close btn", ng-click="removeIdealRange($parent.$index, $index);")
                        | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>


                      //- div(class="sensor-type icon {{idealRange.sCode}}")
                      //-   | <i class="icon-glyph icon-{{idealRange.sCode}}" aria-hidden="true"></i>
                      //-   div.screen-reader-text {{idealRange.sCode}}
                      
                      div
                        //label {{sensors[idealRange.sCode].name}}
                        div.custom-dropdown-wrap
                          select(class="custom-dropdown", ng-model="idealRange.sCode", ng-options="sensor.code as sensor.name for (sensorKey,sensor) in sensors | orderBy:name")
                            option(value="") Select Sensor
                          div(class="dblarrow")
                            i
                      
                      div.separator-top
                        label Trigger the following accessory (optional):
                        div.custom-dropdown-wrap
                          select(class="custom-dropdown", ng-model="idealRange.actionBelowMin.control", ng-options="control._id as control.name for (controlKey,control) in controls")
                            option(value="") None
                          div(class="dblarrow")
                            i

                      div(class="hi separator-top")
                        label High
                        input(class="no-disable", type="number", ng-model="idealRange.valueRange.max")
                        span {{sensors[idealRange.sCode].unit}}
                        textarea(placeholder="Describe the triggered action.", ng-model="idealRange.actionBelowMin.description")
                        //- div(ng-show="idealRange.actionAboveMax.control") Turn {{controls[idealRange.actionAboveMax.control].name}} to {{idealRange.actionAboveMax.singleStateValue}}

                      div(class="lo separator-top")
                        label Low
                        input(class="no-disable", type="number", ng-model="idealRange.valueRange.min")
                        span {{sensors[idealRange.sCode].unit}}
                        textarea(placeholder="Describe the triggered action.", ng-model="idealRange.actionBelowMin.description")
                        //- div(ng-show="idealRange.actionBelowMin.control") Turn {{controls[idealRange.actionBelowMin.control].name}} to {{idealRange.actionBelowMin.singleStateValue}}


                      div.separator-top
                        label What time of day should the ideal range apply?
                        div(class="custom-checkbox-wrap")
                          input(id="action_control_time_{{$index}}", class="no-disable", type="checkbox", ng-model="idealRange.noApplicableTimeSpan", ng-click="toggleIdealRangeApplicableTimeSpan(this)")
                          label(for="action_control_time_{{$index}}") All Day

                        div.idealRange-applicableTimePicker(ng-hide="idealRange.noApplicableTimeSpan")
                          // TODO: figure out how initialize values when idealRange.applicableTimeSpan is undefined (and leave them alone when it is defined)
                          label.idealRangeStartTime Start Time
                          div.custom-dropdown-wrap
                            select(class="custom-dropdown", ng-required="!idealRange.noApplicableTimeSpan", ng-model="idealRange.applicableTimeSpan.startTime", ng-options="time.ms as time.str for time in timesOfDayList")
                              option(value="") Select
                            div(class="dblarrow")
                              i

                          label.idealRangeEndTime End Time
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-required="!idealRange.noApplicableTimeSpan", ng-model="idealRange.applicableTimeSpan.endTime", ng-options="time.ms as time.str for time in timesOfDayList")
                                option(value="") Select
                              div(class="dblarrow")
                                i


                div(class="actions", ng-show="selected.selectedGrowPlanPhaseSection == 3")
                  h4(class="page-heading-large separator-top") Actions
                  p Here's where you set schedules for actions to take throughout the phase. You can create on/off cycles for accessories or just schedule simple notifications
                    | for yourself. If you specify an accessory and have it connected to your Bitponics device, we'll simply trigger its cycles automatically. 
                    | If you don't have a specified accessory connected to your device, instead we'll send you an email notification whenever an action should take place.
                  
                  ul
                    li.add
                      label(class="add btn", ng-click="addAction(sharedDataService.selectedGrowPlan.focusedPhase);") 
                        | Add
                        | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>

                    li(class="question", ng-repeat="action in sharedDataService.selectedGrowPlan.focusedPhase.actionViewModels")
                      div(class="close btn", ng-click="removeAction($parent.$index, $index);")
                        | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>

                      div
                        label Description
                        textarea(placeholder="Describe the action.", ng-model="action.description")

                      div.separator-top
                        label Trigger the following accessory (optional):
                        div.custom-dropdown-wrap
                          select(class="custom-dropdown no-disable", ng-model="action.control", ng-options="control._id as control.name for (controlKey,control) in controls")
                            option(value="") None
                          div(class="dblarrow")
                            i

                      div.separator-top
                        label Is the action repeating?
                        div.custom-dropdown-wrap
                          select(class="custom-dropdown", ng-model="action.scheduleType")
                            option(value="") Select
                            option(value="phaseStart") Once at the start of the phase
                            option(value="phaseEnd") Once at the end of the phase
                            option(value="repeat") Repeat throughout the phase
                          div(class="dblarrow")
                            i


                      div(ng-show="action.scheduleType != 'repeat'")


                      div(ng-show="action.scheduleType == 'repeat'")
                        

                        div(ng-show="action.control")
                          div(class="custom-checkbox-wrap separator-top")
                            input(id="action_control_{{$index}}", type="checkbox", ng-model="action.isDailyControlCycle")
                            label(for="action_control_{{$index}}") Daily

                          div(class="separator-top", ng-show="action.isDailyControlCycle")
                            label Turn {{action.control.name}} on at 
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-model="action.dailyOnTime", ng-options="time.ms as time.str for time in timesOfDayList")
                                option(value="") Select
                              div(class="dblarrow")
                                i

                            label Turn {{action.control.name}} off at 
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-model="action.dailyOffTime", ng-options="time.ms as time.str for time in timesOfDayList")
                                option(value="") Select
                              div(class="dblarrow")
                                i

                          div(class="separator-top", ng-show="!action.isDailyControlCycle")
                            div Repeating actions have alternating on/off states.
                            
                            div
                              p First, turn {{action.control.name}}
                              div(class="custom-checkbox-wrap")
                                input(id="first_action_states_on_{{$index}}", type="radio", value="1", ng-model="action.cycle.states[0].controlValue")
                                label(for="first_action_states_on_{{$index}}") On

                              div(class="custom-checkbox-wrap")
                                input(id="first_action_states_off_{{$index}}", type="radio", value="0", ng-model="action.cycle.states[0].controlValue")
                                label(for="first_action_states_off_{{$index}}") Off

                              div
                                p for
                                input(type="number", ng-model="action.cycle.states[0].duration", value="1")
                                div.custom-dropdown-wrap
                                  select(class="custom-dropdown", ng-model="action.cycle.states[0].durationType", ng-options="durationType for durationType in actionDurationTypeOptions", value="{{actionDurationTypeOptions[1]}}")
                                    option(value="") Select
                                  div(class="dblarrow")
                                    i
                              
                            div 
                              p Then turn {{action.control.name}}
                              div(class="custom-checkbox-wrap")
                                input(id="then_action_states_on_{{$index}}", type="radio", value="1", ng-model="action.cycle.states[1].controlValue")
                                label(for="then_action_states_on_{{$index}}") On

                              div(class="custom-checkbox-wrap")
                                input(id="then_action_states_off_{{$index}}", type="radio", value="0", ng-model="action.cycle.states[1].controlValue")
                                label(for="then_action_states_off_{{$index}}") Off

                              div 
                                p for 
                                input(type="number", ng-model="action.cycle.states[1].duration", value="1")
                                div.custom-dropdown-wrap
                                  select(class="custom-dropdown", ng-model="action.cycle.states[1].durationType", ng-options="durationType for durationType in actionDurationTypeOptions", value="{{actionDurationTypeOptions[1]}}")
                                    option(value="") Select
                                  div(class="dblarrow")
                                    i

                        div(ng-show="!action.control")
                          div.separator-top 
                            label Every:
                            input(type="number", ng-model="action.overallDuration", value="1")
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-model="action.overallDurationType", ng-options="durationType for durationType in actionWithNoAccessoryDurationTypeOptions", value="{{actionDurationTypeOptions[0]}}")
                                option(value="") Select
                              div(class="dblarrow")
                                i

                          div(ng-show="action.overallDurationType == 'days'")
                            label At 
                            div.custom-dropdown-wrap
                              select(class="custom-dropdown", ng-model="action.offsetTimeOfDay", ng-options="time.ms as time.str for time in timesOfDayList")
                                option(value="") Select
                              div(class="dblarrow")
                                i

                          label.separator-top Send me the following message:
                            textarea(ng-model="action.message", placeholder="It's time to...")

                    //- end Action UI
                        
                div(class="device", ng-show="selected.selectedGrowPlanPhaseSection == 4 && userOwnedDevices.length > 0")
                  h4(class="page-heading-large separator-top") Device
                  p Here is where you can pair up your Bitponics device to your grow plan. Click a device name to select it. After you activate the grow plan, your device will start logging readings and automating any actions defined for your connected accessories.
                  ul(class="grid devicelist")
                    li(ng-repeat="device in sharedDataService.userOwnedDevices")
                      label.btn(ng-class="{on:sharedDataService.selected.deviceId == device._id, off: sharedDataService.selected.deviceId != device._id}")
                        input(type='radio', name="device", value="{{device._id}}", ng-model="sharedDataService.selected.deviceId", ng-change="toggleDevice(device)")
                        | {{device.name}}


      div(class="step-footer separator-top")
        input(id="growplans_activate", type="submit", value="Save", ng-disabled="sharedDataService.submit.updateInProgress || sharedDataService.submit.success")
        img.spinner(src="/assets/img/spinner.svg", ng-show="sharedDataService.submit.updateInProgress && !sharedDataService.submit.success", ng-animate="{show: 'fade-in', hide:'fade-out'}")
        //- input(id="growplans_activate", type="submit", value="Activate Grow Plan", ng-click="sharedDataService.activeOverlay = 'ActivationOverlay';sharedDataService.submit();")



block css
  link(rel='stylesheet', href='/assets/css/libs/steps.css')

block content
  
  section.header
      header
        include ../includes/nav/main
  
  section#main(ng-cloak, role="main", class="main split-layout")
      form(id="growplans", name="growplans", class='steps', data-ajax="false", ng-submit="submit()", ng-controller="bpn.controllers.growPlan.Main", novalidate)
        section.progress-bar(ng-show="sharedDataService.pageMode == 'setup'")
          ol
            li.complete 
              a.number(href="/setup/grow-plan") 1.
                |  Select Grow Plan
            li.active 
              span.number 2.
              |  Customize Grow Plan
            li.future 
              span.number 3.
              |  Activate Garden

        section(ng-view)
        
        //- Overlay Templates

        div
          div(ng-controller="bpn.controllers.growPlan.PlantOverlay", modal="sharedDataService.activeOverlay=='PlantOverlay'", close="close()", options="sharedDataService.modalOptions")
            div(ng-controller="bpn.controllers.SelectionOverlay", class="overlay-contain")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              h3(class="page-heading page-heading-small") Add a Plant
              div
                input(class="search no-validate", ng-model="query", ng-change="search()", placeholder="Search...")
                div(ng-hide="filteredItems.length") 
                  label(href="#", class="add btn", ng-click="addPlant(this)")
                    | Add New Plant
                    | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                
                ul(class="grid grid--top grid--wrapping grid--gutters grid--full medium-grid--1of3 small-no-flexbox-grid--1of2 medium-no-flexbox-grid--1of3 plantlist")
                  li(ng-repeat="plant in pagedItems[currentPage] | orderBy:sortingOrder:name", class="grid-cell grid-cell--center")
                    div.img-wrapper
                      div.icon-glyph.icon-__62_logo_00e36c
                      img(ng-src="//s3.amazonaws.com/bitponics-cdn/assets/img/plants/{{plant._id}}.jpg", alt="{{plant.name}}")
                        
                    div.custom-checkbox-wrap
                      input(id="search_{{plant._id}}", 
                        type='checkbox', 
                        name="plants", 
                        value="{{plant._id}}", 
                        ng-model="sharedDataService.selected.plants[plant._id]"
                      )
                      label(for="search_{{plant._id}}", class="plant btn") {{plant.name}}
                
                ul.pagination
                  li(ng-class="{disabled: currentPage == 0}")
                    a(href, ng-click="prevPage()")  Prev
                  li(ng-repeat="n in range(pagedItems.length)", ng-class="{active: n == currentPage}")
                    a(href, ng-click="setPage()", ng-bind="n + 1") 1
                  li(ng-class="{disabled: currentPage == pagedItems.length - 1}")
                    a(href, ng-click="nextPage()") Next 

        div
          div(ng-controller="bpn.controllers.growPlan.FixtureOverlay", modal="sharedDataService.activeOverlay=='FixtureOverlay'", close="close()", options="sharedDataService.modalOptions")
            div(ng-controller="bpn.controllers.SelectionOverlay")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              h3(class="page-heading page-heading-small") Choose a Fixture
              div(ng-controller="overlayCtrl")
                input(class="search no-validate", ng-model="query", ng-change="search()", placeholder="Search...")
                div(ng-hide="filteredItems.length") 
                  label(href="#", class="add btn", ng-click="addFixture(this)")
                    | Add New Fixture
                    | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>

                ul(class="grid plantlist")
                  li(ng-repeat="item in pagedItems[currentPage] | orderBy:sortingOrder:name")
                    img(src="/assets/img/placeholders/placeholder_plant.jpg", alt="{{item.name}}")
                    dl
                      dt Brand:
                      dd.brand {{item.brand || '--'}}
                      dt Name:
                      dd.name {{item.name}}
                      dt Type:
                      dd.type {{item.type}}
                      dt Watts:
                      dd.watts {{item.watts}}
                      dt # of bulbs per fixture:
                      dd.bulbs {{item.bulbCapacity}}

                    input(id="fixture_{{item._id}}", 
                      type='radio',
                      name="lightFixtureOverlaySelection", 
                      value="{{item._id}}", 
                      ng-model="item",
                      ng-checked="item._id == sharedDataService.selectedGrowPlan.focusedPhase.light.fixture._id",
                      ng-click="sharedDataService.selectedGrowPlan.focusedPhase.light.fixture = item")
                    label(for="fixture_{{item._id}}", class="item btn next-step-btn") Select
                
                ul.pagination
                  li(ng-class="{disabled: currentPage == 0}")
                    a(href, ng-click="prevPage()")  Prev
                  li(ng-repeat="n in range(pagedItems.length)", ng-class="{active: n == currentPage}")
                    a(href, ng-click="setPage()", ng-bind="n + 1") 1
                  li(ng-class="{disabled: currentPage == pagedItems.length - 1}")
                    a(href, ng-click="nextPage()") Next 


        div
          div(ng-controller="bpn.controllers.growPlan.BulbOverlay", modal="sharedDataService.activeOverlay=='BulbOverlay'", close="close()", options="sharedDataService.modalOptions")
            div(ng-controller="bpn.controllers.SelectionOverlay")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              h3(class="page-heading page-heading-small") Choose a Bulb
              div(ng-controller="overlayCtrl")
                input(class="search no-validate", ng-model="query", ng-change="search()", placeholder="Search...")
                div(ng-hide="filteredItems.length") 
                  label(href="#", class="add btn", ng-click="addBulb(this)")
                    | Add New Bulb
                    | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                
                ul(class="grid plantlist")
                  li(ng-repeat="item in pagedItems[currentPage] | orderBy:sortingOrder:name")
                    img(src="/assets/img/placeholders/placeholder_plant.jpg", alt="{{item.name}}")
                    dl
                      dt Brand:
                      dd {{item.brand || '--'}}
                      dt Name:
                      dd {{item.name}}
                      dt Type:
                      dd {{item.type}}
                      dt Watts:
                      dd {{item.watts}}

                    input(id="bulb_{{item._id}}", 
                      type='radio', 
                      name="lightBulb", 
                      value="{{item._id}}", 
                      ng-model="item._id",
                      ng-checked="item._id == sharedDataService.selectedGrowPlan.focusedPhase.light.bulb._id",
                      ng-click="sharedDataService.selectedGrowPlan.focusedPhase.light.bulb = item")
                    label(for="bulb_{{item._id}}", class="item btn next-step-btn") Select
                
                ul.pagination
                  li(ng-class="{disabled: currentPage == 0}")
                    a(href, ng-click="prevPage()")  Prev
                  li(ng-repeat="n in range(pagedItems.length)", ng-class="{active: n == currentPage}")
                    a(href, ng-click="setPage()", ng-bind="n + 1") 1
                  li(ng-class="{disabled: currentPage == pagedItems.length - 1}")
                    a(href, ng-click="nextPage()") Next 


        div
          div(ng-controller="bpn.controllers.growPlan.GrowSystemOverlay", modal="sharedDataService.activeOverlay=='GrowSystemOverlay'", close="close()", options="sharedDataService.modalOptions")
            div(ng-controller="bpn.controllers.SelectionOverlay")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              h3(class="page-heading page-heading-small") Choose a Grow System
              div(ng-controller="overlayCtrl")
                input(class="search no-validate", ng-model="query", ng-change="search()", placeholder="Search...")
                div(ng-hide="filteredItems.length") 
                  label(href="#", class="add btn", ng-click="addGrowSystem(this)")
                    | Add New Grow System
                    | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                
                ul(class="grid plantlist")
                  li(ng-repeat="item in pagedItems[currentPage] | orderBy:sortingOrder:name")
                    img(src="/assets/img/placeholders/placeholder_plant.jpg", alt="{{item.name}}")
                    dl
                      dt Name:
                      dd {{item.name}}
                      dt Description:
                      dd.description {{item.description}}
                      dt Type:
                      dd {{item.type}}
                      dt Plant Capacity:
                      dd {{item.plantCapacity}}
                      dt Size:
                      dd
                        div(ng-show="item.overallSize.w && item.overallSize.h && item.overallSize.d") 
                          | {{item.overallSize.w}} wide x {{item.overallSize.h}} high x {{item.overallSize.d}} deep
                        div(ng-hide="item.overallSize.w && item.overallSize.h && item.overallSize.d") 
                          | -

                    input(id="growsystem_{{item._id}}", 
                      type='radio', 
                      name="growSystem", 
                      value="{{item._id}}", 
                      ng-model="item._id",
                      ng-checked="item._id == sharedDataService.selectedGrowPlan.focusedPhase.growSystem._id",
                      ng-click="sharedDataService.selectedGrowPlan.focusedPhase.growSystem = item")
                    label(for="growsystem_{{item._id}}", class="item btn next-step-btn") Select
                      //- | <i class="icon-glyph icon-glypharrow" aria-hidden="true"></i>
                
                ul.pagination
                  li(ng-class="{disabled: currentPage == 0}")
                    a(href, ng-click="prevPage()")  Prev
                  li(ng-repeat="n in range(pagedItems.length)", ng-class="{active: n == currentPage}")
                    a(href, ng-click="setPage()", ng-bind="n + 1") 1
                  li(ng-class="{disabled: currentPage == pagedItems.length - 1}")
                    a(href, ng-click="nextPage()") Next 

      
        div
          div(ng-controller="bpn.controllers.growPlan.NutrientOverlay", modal="sharedDataService.activeOverlay=='NutrientOverlay'", close="close()", options="sharedDataService.modalOptions")
              div(ng-controller="bpn.controllers.SelectionOverlay")
                div(class="close btn", ng-click="close()")
                  | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
                h3(class="page-heading page-heading-small") Choose a Nutrient
                div(ng-controller="overlayCtrl")
                  input(class="search no-validate", ng-model="query", ng-change="search()", placeholder="Search...")
                  div(ng-hide="filteredItems.length") 
                    label(href="#", class="add btn", ng-click="addGrowSystem(this)")
                      | Add New Nutrient
                      | <i class="icon-glyph-new icon-__60_plus_white" aria-hidden="true"></i>
                  
                  ul(class="grid plantlist")
                    li(ng-repeat="item in pagedItems[currentPage] | orderBy:sortingOrder:name")
                      img(src="/assets/img/placeholders/placeholder_plant.jpg", alt="{{item.name}}")
                      dl
                        dt Brand:
                        dd {{item.brand}}
                        dt Name:
                        dd {{item.name}}

                      input(id="nutrient_{{item._id}}", 
                        type='checkbox', 
                        name="nutrientsOverlaySelections", 
                        value="{{item._id}}", 
                        ng-model="item.selected", 
                        ng-change="toggleItemSelection(item, this)", 
                        ng-checked="sharedDataService.selectedGrowPlan.focusedPhase.nutrientsViewModel[item._id]")
                      label(for="nutrient_{{item._id}}", class="nutrient btn next-step-btn") Select
                  
                  ul.pagination
                    li(ng-class="{disabled: currentPage == 0}")
                      a(href, ng-click="prevPage()")  Prev
                    li(ng-repeat="n in range(pagedItems.length)", ng-class="{active: n == currentPage}")
                      a(href, ng-click="setPage()", ng-bind="n + 1") 1
                    li(ng-class="{disabled: currentPage == pagedItems.length - 1}")
                      a(href, ng-click="nextPage()") Next 
        div
          div(ng-controller="bpn.controllers.growPlan.ActivationOverlay", modal="sharedDataService.activeOverlay=='ActivationOverlay'", close="close()", options="{ dialogClass: 'overlay dead-end auto-size', backdropFade: true, dialogFade: true }")
            div(class="overlay-contain")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              div(ng-show="!sharedDataService.submit.error")
                h3(class="page-heading page-heading-small") Garden Activated
                p 
                  | Your garden is all set up! Visit your garden's 
                  a(class="link", href="/gardens/{{sharedDataService.createdGrowPlanInstanceId}}") dashboard 
                  | to view your progress, monitor sensor readings and control any connected accessories.
              div(ng-show="sharedDataService.submit.error")
                h3(class="page-heading page-heading-small error") Garden Error
                p.error
                  | There was a technical problem and your garden was not set up.
        
        div
          div(
            ng-controller="bpn.controllers.growPlan.SaveOverlay", 
            modal="sharedDataService.activeOverlay=='SaveOverlay'", 
            close="close()", 
            options="{ dialogClass: 'overlay dead-end auto-size', backdropFade: true, dialogFade: true }")
            
            div(class="overlay-contain")
              div(class="close btn", ng-click="close()")
                | <i class="icon-glyph-new icon-__72_x_999999" aria-hidden="true"></i>
              div(ng-show="!sharedDataService.submit.error")
                
                
                div(ng-show="sharedDataService.originalGrowPlanId === sharedDataService.selectedGrowPlan._id")
                  h3(class="page-heading page-heading-small") Grow Plan Updated
                  p Your grow plan has been updated! Your 
                    a(class="link", href="/gardens") gardens
                    |  should now reflect the new updates. Happy growing!
                div(ng-show="sharedDataService.originalGrowPlanId !== sharedDataService.selectedGrowPlan._id")
                  h3(class="page-heading page-heading-small") You just contributed to the exploration of gardening knowledge!
                  p We created you your very own branch of this grow plan. Now the community can learn how your changes help plant growth.
                  p Any gardens that were using the original have been migrated to your new branch.
                  p  
                    a.btn(class="link", href="/grow-plans/{{sharedDataService.selectedGrowPlan._id}}", ng-click="loadGrowPlanPage()") Visit your new grow plan page
                  
              div(ng-show="sharedDataService.submit.error")
                h3(class="page-heading page-heading-small error") Error saving changes
                p.error
                  | There was a technical problem while attempting to save your changes. We're sorry for disrupting your flow. Feel free to 
                  span(data-bpn-directives-intercom-trigger) contact us
                  |  and let's see if we can help.

        //- End Overlay Templates
        
        

block footer-scripts

  script
    bpn.user = !{JSON.stringify(user.toPublicJSON())};
    bpn.growPlan = !{JSON.stringify(growPlan)};
    bpn.growSystems = !{JSON.stringify(growSystems)};
    bpn.actions = !{JSON.stringify(actions)};
    bpn.controls = !{JSON.stringify(controls)};
    bpn.sensors = !{JSON.stringify(sensors)};
    bpn.plants = !{JSON.stringify(plants)};
    bpn.userOwnedDevices = !{JSON.stringify(userOwnedDevices)};
    bpn.lights = !{JSON.stringify(lights)};
    bpn.lightFixtures = !{JSON.stringify(lightFixtures)};
    bpn.lightBulbs = !{JSON.stringify(lightBulbs)};
    bpn.nutrients = !{JSON.stringify(nutrients)};
